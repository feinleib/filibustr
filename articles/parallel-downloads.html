<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Download Voteview data in parallel • filibustr</title>
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="parallel-downloads_files/libs/quarto-html/popper.min.js"></script><script src="parallel-downloads_files/libs/quarto-html/tippy.umd.min.js"></script><link href="parallel-downloads_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="parallel-downloads_files/libs/quarto-html/light-border.css" rel="stylesheet">
<!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Download Voteview data in parallel">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">filibustr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.1.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/parallel-downloads.html">Download Voteview data in parallel</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/feinleib/filibustr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-quarto">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Download Voteview data in parallel</h1>




      <small class="dont-index">Source: <a href="https://github.com/feinleib/filibustr/blob/main/vignettes/parallel-downloads.qmd" class="external-link"><code>vignettes/parallel-downloads.qmd</code></a></small>
      <div class="d-none name"><code></code></div>
    </div>






    <div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://feinleib.github.io/filibustr/">filibustr</a></span><span class="op">)</span></span></code></pre></div>
</div>
<p>The Voteview functions have the power to download lots of data on many years of Congress. One downside of this power is that downloading many large datasets from the internet can be slow.</p>
<p>One way to speed up your data downloads is to <strong>download data in parallel</strong>. When you call a Voteview function to download data from multiple Congresses (i.e., when <code>length(congress) &gt; 1</code>), <a href="https://feinleib.github.io/filibustr/">filibustr</a> will download data in parallel if you have set up that capability.</p>
<p><strong>Everything described below is a purely optional way to accelerate your data imports.</strong> If you don’t set up parallel computing processes, the Voteview functions will simply download data sequentially.</p>
<section class="level2"><h2 id="setting-up-for-parallel-downloads">Setting up for parallel downloads<a class="anchor" aria-label="anchor" href="#setting-up-for-parallel-downloads"></a>
</h2>
<p>Downloading data in parallel requires a short bit of setup in the beginning.</p>
<section class="level3"><h3 id="make-sure-the-mirai-and-carrier-packags-are-installed">Make sure the <code>{mirai}</code> and <code>{carrier}</code> packags are installed<a class="anchor" aria-label="anchor" href="#make-sure-the-mirai-and-carrier-packags-are-installed"></a>
</h3>
<p>Under the hood, the Voteview functions use <code><a href="https://purrr.tidyverse.org/reference/in_parallel.html" class="external-link">purrr::in_parallel()</a></code> for parallel downloads. <code><a href="https://purrr.tidyverse.org/reference/in_parallel.html" class="external-link">purrr::in_parallel()</a></code> depends on two packages (<a href="https://mirai.r-lib.org" class="external-link">mirai</a> and <a href="https://github.com/r-lib/carrier" class="external-link">carrier</a>) that are not otherwise used in <a href="https://feinleib.github.io/filibustr/">filibustr</a>, so you may not have them installed.</p>
<p><strong>To check if you have installed the required versions of these packages, run this code.</strong> It will prompt you to install any packages you’re missing.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/is_installed.html" class="external-link">check_installed</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"carrier"</span>, <span class="st">"mirai"</span><span class="op">)</span>, version <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"0.3.0"</span>,  <span class="st">"2.5.1"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</section><section class="level3"><h3 id="set-parallel-processes">Set parallel processes<a class="anchor" aria-label="anchor" href="#set-parallel-processes"></a>
</h3>
<p><strong>To download Voteview data in parallel, use <code><a href="https://mirai.r-lib.org/reference/daemons.html" class="external-link">mirai::daemons()</a></code></strong> to create parallel processes (<a href="https://mirai.r-lib.org" class="external-link">mirai</a> calls these “daemons”).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># detect the number of cores available on your machine</span></span>
<span><span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html" class="external-link">detectCores</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># launch a specific number of processes, or</span></span>
<span><span class="fu">mirai</span><span class="fu">::</span><span class="fu"><a href="https://mirai.r-lib.org/reference/daemons.html" class="external-link">daemons</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span></span>
<span><span class="co"># launch a process on all but one available cores</span></span>
<span><span class="fu">mirai</span><span class="fu">::</span><span class="fu"><a href="https://mirai.r-lib.org/reference/daemons.html" class="external-link">daemons</a></span><span class="op">(</span><span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html" class="external-link">detectCores</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
</div>
<section class="level4"><h4 id="how-many-processes-should-i-create">How many processes should I create?<a class="anchor" aria-label="anchor" href="#how-many-processes-should-i-create"></a>
</h4>
<p>In general, if you split the work up across more processes, the download will finish faster. Theoretically, N processes can finish the download up to N times faster.</p>
<p>At the same time, there can be diminishing returns to creating a large number of processes.</p>
<ul>
<li>First, <strong>there is some overhead</strong> involved with creating and communicating with parallel processes.</li>
<li>Second, <strong>consider the number of pieces of work.</strong> Multi-Congress data downloads get one file per Congress. That is the unit of work that the parallel processes can work on.
<ul>
<li>If you are downloading data on 5 Congresses, but create 8 parallel processes, then the last 3 processes aren’t doing anything.</li>
<li>Similarly, if you’re downloading data on 12 Congresses, there’s not much difference between 7, 8, and 9 processes.</li>
</ul>
</li>
</ul>
<p>Also, there is less benefit when you set more processes than the number of cores available on your machine (which you can see using <code><a href="https://rdrr.io/r/parallel/detectCores.html" class="external-link">parallel::detectCores()</a></code>). A good rule of thumb (per the <a href="https://purrr.tidyverse.org/reference/in_parallel.html#daemons-settings" class="external-link">purrr documentation</a>) is to <strong>use (at most) one less than the number of cores on your machine</strong>, leaving one core open for the main R process.</p>
</section></section></section><section class="level2"><h2 id="downloading-data-in-parallel">Downloading data in parallel<a class="anchor" aria-label="anchor" href="#downloading-data-in-parallel"></a>
</h2>
<p>Once you’ve set up your parallel processes, <strong>just call the Voteview functions like normal</strong>, and they will automatically download data in parallel!</p>
<p><strong>Reminder:</strong> parallel processing only impacts downloads where <code>length(congress) &gt; 1</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># download Voteview data from multiple Congresses</span></span>
<span><span class="fu"><a href="../reference/get_voteview_members.html">get_voteview_members</a></span><span class="op">(</span>congress <span class="op">=</span> <span class="fl">95</span><span class="op">:</span><span class="fl">118</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/get_voteview_rollcall_votes.html">get_voteview_rollcall_votes</a></span><span class="op">(</span>congress <span class="op">=</span> <span class="fl">95</span><span class="op">:</span><span class="fl">118</span><span class="op">)</span></span></code></pre></div>
</div>
<p>When you’re done with all your parallel processing, you can close the daemon connections with <code>mirai::daemons(0)</code> if you’d like. The connections will close automatically when your session ends otherwise.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">mirai</span><span class="fu">::</span><span class="fu"><a href="https://mirai.r-lib.org/reference/daemons.html" class="external-link">daemons</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span></span></code></pre></div>
</div>
</section><section class="level2"><h2 id="more-details">More details<a class="anchor" aria-label="anchor" href="#more-details"></a>
</h2>
<p>See the documentation for <code><a href="https://purrr.tidyverse.org/reference/in_parallel.html" class="external-link">purrr::in_parallel()</a></code> and <a href="https://mirai.r-lib.org" class="external-link">mirai</a> (especially <code><a href="https://mirai.r-lib.org/reference/daemons.html" class="external-link">mirai::daemons()</a></code>) for additional details on parallel processing.</p>
</section><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config);
    }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script></main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Max Feinleib.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
